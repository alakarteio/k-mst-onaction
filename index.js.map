{"version":3,"file":"index.js","sources":["src/helpers/take.js","src/utils/isGenerator.js","src/runners/runArray.js","src/runners/runGenerator.js","src/runners/runFunction.js","src/getAction.js","src/middleware.js"],"sourcesContent":["import { isRegExp, isString, isFunction } from 'lodash'\n\nconst take = (match, callback) => (action, tree) => {\n  const isMatching = false\n    || (isString(match) && match === action.fullpath)\n    || (isFunction(match) && match(action, tree))\n    || (isRegExp(match) && action.fullpath.match(match))\n\n  if (isMatching) return callback(action, tree)\n  return false\n}\n\nconst ended = (match, callback) => (action, tree) => {\n  if (action.ended) return take(match, callback)(action, tree)\n  return false\n}\n\ntake.ended = ended\n\nexport default take\n","const GeneratorFunction = (function* foo() { }).constructor // eslint-disable-line no-empty-function\n\nexport default fn => fn instanceof GeneratorFunction\n","export default (dispatch, action, tree) => {\n  dispatch.forEach(runner => runner(action, tree))\n}\n","export default (dispatch, action, tree) => {\n  const runner = dispatch(action, tree)\n  let step = { done: false }\n\n  while (!step.done) {\n    step = runner.next()\n    if (!step.done) step.value(action, tree)\n  }\n}\n","import { isArray } from 'lodash'\n\nexport default (dispatch, action, tree) => {\n  const dispatchCall = dispatch(action, tree)\n  if (!dispatchCall) return\n  if (isArray(dispatchCall)) dispatchCall.forEach(runner => runner(action, tree))\n}\n","import { getPath } from 'mobx-state-tree'\n\nexport default (call) => {\n  const {\n    name,\n    type,\n    context,\n    args,\n  } = call\n\n  const path = getPath(context)\n  const fullpath = `${path}/${name}`\n\n  const action = {\n    fullpath,\n    path,\n    name,\n    args,\n  }\n\n  switch (type) {\n    case 'process_return': return { ...action, ended: true }\n    case 'action': return action\n    default: return undefined\n  }\n}\n","import { isArray, isFunction } from 'lodash'\nimport { isGenerator } from './utils'\nimport { runArray, runFunction, runGenerator } from './runners'\nimport getAction from './getAction'\n\nconst run = dispatch => (action, tree) => {\n  if (isFunction(dispatch)) {\n    if (isGenerator(dispatch)) return runGenerator(dispatch, action, tree)\n    return runFunction(dispatch, action, tree)\n  }\n\n  if (isArray(dispatch)) return runArray(dispatch, action, tree)\n\n  throw new Error('[trampss-mst-onaction] unknow dispatch type')\n}\n\nexport default (dispatch) => {\n  const runDispatch = run(dispatch)\n\n  return (call, next) => {\n    const action = getAction(call)\n\n    if (action) runDispatch(action, call.tree)\n\n    return next(call)\n  }\n}\n"],"names":["take","match","callback","action","tree","isString","fullpath","isFunction","isRegExp","ended","GeneratorFunction","foo","constructor","fn","dispatch","forEach","runner","step","done","next","value","dispatchCall","isArray","call","name","type","context","args","path","getPath","run","isGenerator","runGenerator","runFunction","runArray","Error","runDispatch","getAction"],"mappings":"+SAEA,IAAMA,EAAO,SAACC,EAAOC,UAAa,SAACC,EAAQC,YAEnCC,WAASJ,IAAUA,IAAUE,EAAOG,UACpCC,aAAWN,IAAUA,EAAME,EAAQC,IACnCI,WAASP,IAAUE,EAAOG,SAASL,MAAMA,KAExBC,EAASC,EAAQC,KAS1CJ,EAAKS,MALS,SAACR,EAAOC,UAAa,SAACC,EAAQC,WACtCD,EAAOM,OAAcT,EAAKC,EAAOC,EAAZF,CAAsBG,EAAQC,KCbzD,IAAMM,0BAAqB,SAAUC,+GAAAA,UAAWC,iCAE3BC,aAAcH,cCFnBI,EAAUX,EAAQC,KACvBW,QAAQ,mBAAUC,EAAOb,EAAQC,iBCD5BU,EAAUX,EAAQC,WAC1BY,EAASF,EAASX,EAAQC,GAC5Ba,GAASC,MAAM,IAEXD,EAAKC,SACJF,EAAOG,QACJD,MAAMD,EAAKG,MAAMjB,EAAQC,eCJvBU,EAAUX,EAAQC,OAC1BiB,EAAeP,EAASX,EAAQC,GACjCiB,GACDC,UAAQD,IAAeA,EAAaN,QAAQ,mBAAUC,EAAOb,EAAQC,ilCCH3DmB,OAEZC,EAIED,EAJFC,KACAC,EAGEF,EAHFE,KACAC,EAEEH,EAFFG,QACAC,EACEJ,EADFI,KAGIC,EAAOC,UAAQH,GAGfvB,YAFcyB,MAAQJ,+BASpBC,OACD,6BAA8BtB,GAAQM,OAAO,QAC7C,gBAAiBN,mBCjBpB2B,EAAM,mBAAY,SAAC3B,EAAQC,MAC3BG,aAAWO,UACTiB,EAAYjB,GAAkBkB,EAAalB,EAAUX,EAAQC,GAC1D6B,EAAYnB,EAAUX,EAAQC,MAGnCkB,UAAQR,GAAW,OAAOoB,EAASpB,EAAUX,EAAQC,SAEnD,IAAI+B,MAAM,oEAGFrB,OACRsB,EAAcN,EAAIhB,UAEjB,SAACS,EAAMJ,OACNhB,EAASkC,EAAUd,UAErBpB,GAAQiC,EAAYjC,EAAQoB,EAAKnB,MAE9Be,EAAKI"}